<div class="bg-gray-50 rounded-xl py-2 px-1 sm:px-4">  

  <div class="flex justify-between items-center overflow-x-scroll">
    @for (node of nodes; track node.id; let i = $index) {
      <div
        class="flex flex-col items-center gap-1 cursor-pointer"
        (click)="onNodeClick($event, node.id)"
        cdkOverlayOrigin
        #parentTrigger="cdkOverlayOrigin"
      >
        <div class="rounded-full flex justify-center items-center w-10 h-10 relative" [ngStyle]="{ 'background-color': node.iconBackgroundColor }">
          <mat-icon [ngStyle]="{ 'color': node.iconColor }">storage</mat-icon>
          @if(node.badgeType){
            <mat-icon class="!text-purple-700 absolute -top-2 -right-2">account_circle</mat-icon>
          }
        </div>
        <p class="text-gray-700 font-semibold text-sm">{{ node.name }}</p>
      </div>

      @if (i < nodes.length - 1) {
        <div class="flex-1 h-[2px] bg-gray-300 mx-4 relative">
          <div class="absolute -right-2 top-1/2 -translate-y-1/2 w-0 h-0 
                      border-t-[5px] border-t-transparent 
                      border-l-[8px] border-l-gray-400 
                      border-b-[5px] border-b-transparent">
          </div>
        </div>
      }

      <ng-template
        cdkConnectedOverlay
        [cdkConnectedOverlayOrigin]="parentTrigger"
        [cdkConnectedOverlayOpen]="openPopoverId === node.id"
        (backdropClick)="closePopover()"
        (detach)="closePopover()"
        [cdkConnectedOverlayPositions]="[
          { originX: 'center', originY: 'bottom', overlayX: 'center', overlayY: 'top', offsetY: 8 }
        ]"
      >
        @if(node.type === 'vulnerability'){
          <app-vulnerabilities-drawer></app-vulnerabilities-drawer>
        }
        @else if(node.type === 'fix'){
          <app-fix-drawer></app-fix-drawer>
        }
        @else if(node.type === 'action'){
          <app-action-drawer></app-action-drawer>
        }
      </ng-template>

      <div class="flex flex-col gap-4">
      @if (node.children.length > 0) {
          @for (child of node.children; track child.id) {
            <div
              class="flex flex-col items-center gap-1 cursor-pointer"
              (click)="onNodeClick($event, child.id)"
              cdkOverlayOrigin
              #childTrigger="cdkOverlayOrigin"
            >
              <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10 relative">
                <mat-icon class="!text-[#1774DE]">storage</mat-icon>
                @if(child.badgeType){
                  <mat-icon class="!text-red-700 absolute -top-2 -right-2">gpp_bad</mat-icon>
                }
              </div>
              <p class="text-gray-700 font-semibold text-sm">{{ child.name }}</p>
              <p class="text-gray-500 text-xs">{{ child.ipAddress }}</p>
            </div>

            <ng-template
              cdkConnectedOverlay
              [cdkConnectedOverlayOrigin]="childTrigger"
              [cdkConnectedOverlayOpen]="openPopoverId === child.id"
              (backdropClick)="closePopover()"
              (detach)="closePopover()"
              [cdkConnectedOverlayPositions]="[
                { originX: 'center', originY: 'bottom', overlayX: 'center', overlayY: 'top', offsetY: 8 }
              ]"
            >
              @if(child.type === 'vulnerability'){
                <app-vulnerabilities-drawer></app-vulnerabilities-drawer>
              }
              @else if(child.type === 'fix'){
                <app-fix-drawer></app-fix-drawer>
              }
              @else if(child.type === 'action'){
                <app-action-drawer></app-action-drawer>
              }
            </ng-template>
          }
        }
      </div>
  }

  </div>

<div class="flex sm:gap-8 gap-2 border-t border-gray-200 pt-2 mt-4">
  <div class="flex sm:gap-2 gap-1 items-center">
    <mat-icon class="!text-red-700">gpp_bad</mat-icon>
    <p class="font-bold sm:text-base text-sm text-red-700">Lorem</p>
  </div>
  <div class="flex sm:gap-2 gap-1 items-center">
    <mat-icon style="color: #FF9500">gpp_bad</mat-icon>
    <p class="font-bold sm:text-base text-sm" style="color: #FF9500">Lorem</p>
  </div>
  <div class="flex sm:gap-2 gap-1 items-center">
    <mat-icon class="!text-green-700">safety_check</mat-icon>
    <p class="font-bold sm:text-base text-sm text-green-700">Lorem</p>
  </div>
</div>
</div>



<!-- <div class="bg-gray-50 rounded-xl py-2 px-1 sm:px-4">  

    <div class="flex justify-between items-center overflow-x-scroll">
      @for (node of nodes; track node.id) {
          <div
            class="flex flex-col items-center gap-1 cursor-pointer"
            (click)="onNodeClick($event, node.id)"
            cdkOverlayOrigin
            #parentTrigger="cdkOverlayOrigin"
          >
            <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-7 h-7 md:w-10 md:h-10 sm:w-8 sm:h-8">
              <mat-icon class="!text-[#1774DE] md:!text-[#C7A800] sm:!text-[#FFF] !text-[12px] md:!text-[18px] sm:!text-[16px]">storage</mat-icon>
            </div>
            <p class="text-gray-700 font-semibold !text-xs md:!text-md sm:!text-sm">{{ node.name }}</p>
          </div>
  
          <ng-template
            cdkConnectedOverlay
            [cdkConnectedOverlayOrigin]="parentTrigger"
            [cdkConnectedOverlayOpen]="openPopoverId === node.id"
            (backdropClick)="closePopover()"
            (detach)="closePopover()"
            [cdkConnectedOverlayPositions]="[
              { originX: 'center', originY: 'bottom', overlayX: 'center', overlayY: 'top', offsetY: 8 }
            ]"
          >
            @if(node.type === 'vulnerability'){
              <app-vulnerabilities-drawer></app-vulnerabilities-drawer>
            }
            @else if(node.type === 'fix'){
              <app-fix-drawer></app-fix-drawer>
            }
            @else if(node.type === 'action'){
              <app-action-drawer></app-action-drawer>
            }
          </ng-template>
  


          <div class="flex flex-col gap-4">
          @if (node.children.length > 0) {
              @for (child of node.children; track child.id) {
                <div
                  class="flex flex-col items-center gap-1 cursor-pointer"
                  (click)="onNodeClick($event, child.id)"
                  cdkOverlayOrigin
                  #childTrigger="cdkOverlayOrigin"
                >
                  <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-7 h-7 md:w-10 md:h-10 sm:w-8 sm:h-8">
                    <mat-icon class="!text-[#1774DE] md:!text-[#C7A800] sm:!text-[#FFF] !text-[12px] md:!text-[18px] sm:!text-[16px]">storage</mat-icon>
                  </div>
                  <p class="text-gray-700 font-semibold !text-xs md:!text-md sm:!text-sm truncate">{{ child.name }}</p>
                  <p class="text-gray-500 text-xs">{{ child.ipAddress }}</p>

                </div>
  
                <ng-template
                  cdkConnectedOverlay
                  [cdkConnectedOverlayOrigin]="childTrigger"
                  [cdkConnectedOverlayOpen]="openPopoverId === child.id"
                  (backdropClick)="closePopover()"
                  (detach)="closePopover()"
                  [cdkConnectedOverlayPositions]="[
                    { originX: 'center', originY: 'bottom', overlayX: 'center', overlayY: 'top', offsetY: 8 }
                  ]"
                >
                  @if(node.type === 'vulnerability'){
                    <app-vulnerabilities-drawer></app-vulnerabilities-drawer>
                  }
                  @else if(node.type === 'fix'){
                    <app-fix-drawer></app-fix-drawer>
                  }
                  @else if(node.type === 'action'){
                    <app-action-drawer></app-action-drawer>
                  }
                </ng-template>
              }
            }
          </div>
      }


    </div>

  <div class="flex sm:gap-8 gap-2 border-t border-gray-200 pt-2 mt-4">
    <div class="flex sm:gap-2 gap-1 items-center">
      <mat-icon class="!text-red-700">gpp_bad</mat-icon>
      <p class="font-bold sm:text-base text-sm text-red-700">Lorem</p>
    </div>
    <div class="flex sm:gap-2 gap-1 items-center">
      <mat-icon style="color: #FF9500">gpp_bad</mat-icon>
      <p class="font-bold sm:text-base text-sm" style="color: #FF9500">Lorem</p>
    </div>
    <div class="flex sm:gap-2 gap-1 items-center">
      <mat-icon class="!text-green-700">safety_check</mat-icon>
      <p class="font-bold sm:text-base text-sm text-green-700">Lorem</p>
    </div>
  </div>
</div> -->


<!-- <div class="bg-gray-50 rounded-xl py-2 px-4">  

  <div class="bg-gray-50 rounded-xl py-2 px-4">
    <div class="flex justify-between items-center">
      @for (node of nodes; track node.id) {
          <div
            class="flex flex-col items-center gap-1 cursor-pointer"
            (click)="onNodeClick($event, node.id)"
            cdkOverlayOrigin
            #parentTrigger="cdkOverlayOrigin"
          >
            <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
              <mat-icon class="!text-[#1774DE]">storage</mat-icon>
            </div>
            <p class="text-gray-700 font-semibold text-sm">{{ node.name }}</p>
          </div>
  
          <ng-template
            cdkConnectedOverlay
            [cdkConnectedOverlayOrigin]="parentTrigger"
            [cdkConnectedOverlayOpen]="openPopoverId === node.id"
            (backdropClick)="closePopover()"
            (detach)="closePopover()"
            [cdkConnectedOverlayPositions]="[
              { originX: 'center', originY: 'bottom', overlayX: 'center', overlayY: 'top', offsetY: 8 }
            ]"
          >
            @if(node.type === 'vulnerability'){
              <app-vulnerabilities-drawer></app-vulnerabilities-drawer>
            }
            @else if(node.type === 'fix'){
              <app-fix-drawer></app-fix-drawer>
            }
            @else if(node.type === 'action'){
              <app-action-drawer></app-action-drawer>
            }
          </ng-template>
  


          <div class="flex flex-col gap-4">
          @if (node.children.length > 0) {
              @for (child of node.children; track child.id) {
                <div
                  class="flex flex-col items-center gap-1 cursor-pointer"
                  (click)="onNodeClick($event, child.id)"
                  cdkOverlayOrigin
                  #childTrigger="cdkOverlayOrigin"
                >
                  <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
                    <mat-icon class="!text-[#1774DE]">storage</mat-icon>
                  </div>
                  <p class="text-gray-700 font-semibold text-sm">{{ child.name }}</p>
                  <p class="text-gray-500 text-xs">{{ child.ipAddress }}</p>
                </div>
  
                <ng-template
                  cdkConnectedOverlay
                  [cdkConnectedOverlayOrigin]="childTrigger"
                  [cdkConnectedOverlayOpen]="openPopoverId === child.id"
                  (backdropClick)="closePopover()"
                  (detach)="closePopover()"
                  [cdkConnectedOverlayPositions]="[
                    { originX: 'center', originY: 'bottom', overlayX: 'center', overlayY: 'top', offsetY: 8 }
                  ]"
                >
                  @if(node.type === 'vulnerability'){
                    <app-vulnerabilities-drawer></app-vulnerabilities-drawer>
                  }
                  @else if(node.type === 'fix'){
                    <app-fix-drawer></app-fix-drawer>
                  }
                  @else if(node.type === 'action'){
                    <app-action-drawer></app-action-drawer>
                  }
                </ng-template>
              }
            }
          </div>
      }


      
    </div>
  </div>

  <div class="flex gap-8 border-t border-gray-200 pt-2 mt-4">
    <div class="flex gap-2 items-center">
      <mat-icon class="!text-red-700">gpp_bad</mat-icon>
      <p class="font-bold text-base text-red-700">Lorem</p>
    </div>
    <div class="flex gap-2 items-center">
      <mat-icon style="color: #FF9500">gpp_bad</mat-icon>
      <p class="font-bold text-base" style="color: #FF9500">Lorem</p>
    </div>
    <div class="flex gap-2 items-center">
      <mat-icon class="!text-green-700">safety_check</mat-icon>
      <p class="font-bold text-base text-green-700">Lorem</p>
    </div>
  </div>
</div> -->
  
  

    <!-- <div class="flex justify-between items-center">
      @for(node of nodes; track node){
        <div class="flex flex-col items-center gap-1 cursor-pointer" (click)="isOpen = !isOpen" type="button" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
          <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
            <mat-icon class="!text-[#1774DE]">storage</mat-icon>
          </div>
          <p class="text-gray-700 font-semibold text-sm">{{node.name}}</p>
        </div>


        <ng-template
            cdkConnectedOverlay
            [cdkConnectedOverlayOrigin]="trigger"
            [cdkConnectedOverlayOpen]="isOpen"
            (detach)="isOpen = false"
            [cdkConnectedOverlayPositions]="[
              {
                originX: 'center',
                originY: 'bottom',
                overlayX: 'center',
                overlayY: 'top',
                offsetY: 8
              }
            ]"
          >
          <div
            class="bg-white rounded-xl shadow-lg p-4 border border-gray-100"
            (mouseenter)="isOpen = true"
            (mouseleave)="isOpen = false"
          >
            <div class="flex flex-col gap-2">
              <div class="flex gap-2 items-center">
                <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
                  <mat-icon class="!text-[#1774DE]">storage</mat-icon>
                </div>
                <div>
                  <p class="text-gray-900 text-sm font-semibold">Loremipsu</p>
                </div>
              </div>

              <div class="flex gap-2">
                <mat-icon class="!text-[#858D9D]">assignment</mat-icon>
                <p class="text-gray-700 font-bold text-base">Lorem: Loremipsum Loremipsum</p>
                <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
              </div>

              <div class="flex gap-2">
                <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
                <p class="text-gray-700 font-bold text-base">Loremipsum</p>
                <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
                <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
              </div>
            </div>
          </div>
        </ng-template>


        <div class="flex flex-col gap-8">
          @if(node.children.length > 0){
            @for(child of node.children; track child){
              <div class="flex flex-col items-center gap-1 cursor-pointer" (click)="isOpen = !isOpen" type="button" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
                <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
                  <mat-icon class="!text-[#1774DE]">storage</mat-icon>
                </div>
                <p class="text-gray-700 font-semibold text-sm">Loremipsumdolorsit</p>
                <p>{{child.ipAddress}}</p>
              </div>
            }
          }
        </div>
      }
    </div> -->

   


  <!-- <ng-template
      cdkConnectedOverlay
      [cdkConnectedOverlayOrigin]="trigger"
      [cdkConnectedOverlayOpen]="isOpen"
      (detach)="isOpen = false"
      [cdkConnectedOverlayPositions]="[
        {
          originX: 'center',
          originY: 'bottom',
          overlayX: 'center',
          overlayY: 'top',
          offsetY: 8
        }
      ]"
    >
    <div
      class="bg-white rounded-xl shadow-lg p-4 border border-gray-100"
      (mouseenter)="isOpen = true"
      (mouseleave)="isOpen = false"
    >
      <div class="flex flex-col gap-2">
        <div class="flex gap-2 items-center">
          <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
            <mat-icon class="!text-[#1774DE]">storage</mat-icon>
          </div>
          <div>
            <p class="text-gray-900 text-sm font-semibold">Loremipsu</p>
          </div>
        </div>

        <div class="flex gap-2">
          <mat-icon class="!text-[#858D9D]">assignment</mat-icon>
          <p class="text-gray-700 font-bold text-base">Lorem: Loremipsum Loremipsum</p>
          <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
        </div>

        <div class="flex gap-2">
          <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
          <p class="text-gray-700 font-bold text-base">Loremipsum</p>
          <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
          <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
        </div>
      </div>
    </div>
  </ng-template> -->


  <!-- <ng-template
    cdkConnectedOverlay
    [cdkConnectedOverlayOrigin]="trigger"
    [cdkConnectedOverlayOpen]="isOpen"
    (detach)="isOpen = false"
    [cdkConnectedOverlayPositions]="[
      {
        originX: 'center',
        originY: 'bottom',
        overlayX: 'center',
        overlayY: 'top',
        offsetY: 8
      }
    ]"
  >
  <div
    class="bg-white rounded-xl shadow-lg p-4 border border-gray-100"
    (mouseenter)="isOpen = true"
    (mouseleave)="isOpen = false"
  >
    <div class="flex flex-col gap-2">
      <div class="flex gap-2 items-center">
        <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
          <mat-icon class="!text-[#1774DE]">storage</mat-icon>
        </div>
        <div>
          <p class="text-gray-900 text-sm font-semibold">Loremipsumdolorsit</p>
          <p class="text-gray-500 text-xs font-medium">192.168.1.1</p>
        </div>
      </div>

      <div class="flex gap-2">
        <mat-icon class="!text-[#858D9D]">assignment</mat-icon>
        <p class="text-gray-700 font-bold text-base">Lorem:</p>
        <p class="inline-block bg-yellow-50 text-yellow-600 font-bold text-xs rounded leading-6 px-1">Lorem "Ipsum"</p>
      </div>

      <div class="flex gap-2">
        <p class="text-gray-700 font-bold text-base">Loremipsum</p>
        <p class="inline-block bg-blue-50 text-blue-700 font-bold text-xs rounded leading-6 px-1">Lorem "Ipsum"</p>
      </div>
    </div>
  </div>
</ng-template>


<ng-template
  cdkConnectedOverlay
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayOpen]="isOpen"
  (detach)="isOpen = false"
  [cdkConnectedOverlayPositions]="[
    {
      originX: 'center',
      originY: 'bottom',
      overlayX: 'center',
      overlayY: 'top',
      offsetY: 8
    }
  ]"
>
  <div
    class="bg-white rounded-xl shadow-lg p-4 border border-gray-100"
    (mouseenter)="isOpen = true"
    (mouseleave)="isOpen = false"
  >
    <p class="inline-block bg-red-50 text-red-700 font-bold text-xs rounded leading-6 pl-1 pr-6">Lorem Ipsum Dolor Sit</p>
    <div class="mt-3 grid grid-cols-3 gap-1 pl-10">
      <p class="bg-red-50 text-red-700 font-bold text-xs rounded leading-6 pl-1">Lorem Ipsum Dolor Sit</p>
      <p class="bg-red-50 text-red-700 font-bold text-xs rounded leading-6 pl-1">Lorem Ipsum Dolor Sit</p>
      <p class="bg-red-50 text-red-700 font-bold text-xs rounded leading-6 pl-1">Lorem Ipsum Dolor Sit</p>
      <p class="bg-red-50 text-red-700 font-bold text-xs rounded leading-6 pl-1">Lorem Ipsum Dolor Sit</p>
      <p class="bg-red-50 text-red-700 font-bold text-xs rounded leading-6 pl-1">Lorem Ipsum Dolor Sit</p>
      <p class="bg-red-50 text-red-700 font-bold text-xs rounded leading-6 pl-1">Lorem Ipsum Dolor Sit</p>
    </div>
    <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 mt-3 px-1">Lorem: 1.2.3.4</p>
  </div>
</ng-template>


<ng-template
  cdkConnectedOverlay
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayOpen]="isOpen"
  (detach)="isOpen = false"
  [cdkConnectedOverlayPositions]="[
    {
      originX: 'center',
      originY: 'bottom',
      overlayX: 'center',
      overlayY: 'top',
      offsetY: 8
    }
  ]"
>

<div
  class="bg-white rounded-xl shadow-lg p-4 border border-gray-100"
  (mouseenter)="isOpen = true"
  (mouseleave)="isOpen = false"
>
  <div class="flex flex-col gap-2">
    <div class="flex gap-2 items-center">
      <div class="bg-[#D7EAFF] rounded-full flex justify-center items-center w-10 h-10">
        <mat-icon class="!text-[#1774DE]">storage</mat-icon>
      </div>
      <div>
        <p class="text-gray-900 text-sm font-semibold">Loremipsu</p>
      </div>
    </div>

    <div class="flex gap-2">
      <mat-icon class="!text-[#858D9D]">assignment</mat-icon>
      <p class="text-gray-700 font-bold text-base">Lorem:</p>
      <p class="inline-block bg-yellow-50 text-yellow-600 font-bold text-xs rounded leading-6 px-1">Lorem "Ipsum"</p>
      <p class="inline-block bg-green-50 text-green-600 font-bold text-xs rounded leading-6 px-1">Lorem</p>
      <p class="text-gray-700 font-bold text-base">Loremipsum Loremipsum</p>
    </div>

    <div class="flex gap-2">
      <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
      <p class="text-gray-700 font-bold text-base">Loremipsum</p>
      <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
      <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
      <p class="inline-block bg-blue-50 text-blue-600 font-bold text-xs rounded leading-6 px-1">Lorem 1234,5678</p>
    </div>

    <div class="flex gap-2">
      <mat-icon class="!text-[#858D9D]">assignment</mat-icon>
      <p class="text-gray-700 font-bold text-base">Lorem:</p>
      <p class="inline-block bg-yellow-50 text-yellow-600 font-bold text-xs rounded leading-6 px-1">Lorem "Ipsum"</p>
      <p class="text-gray-700 font-bold text-base">Loremipsum Loremipsum</p>
    </div>

    <div class="flex gap-2">
      <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
      <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
      <p class="text-gray-700 font-bold text-base">Loremipsum Loremipsum</p>
      <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
      <p class="inline-block bg-purple-50 text-purple-600 font-bold text-xs rounded leading-6 px-1">1.2.3.4</p>
    </div>

  </div>
</div>
</ng-template> -->
